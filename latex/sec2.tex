\hypertarget{instalar-gtk4-en-linux}{%
\section{Instalar Gtk4 en Linux}\label{instalar-gtk4-en-linux}}

Esta sección describe como instalar Gtk4 en las distribuciones Linux.

No hay garantía.

Si instalas Gtk4 es bajo tu propio riesgo.

La inforación de esta sección es del 27 de Abril de 2022.

Las palabras `actualmente' y/o ``ahora'' en esta sección se ubican en
esta fecha.

Existen 3 maneras de instalar Gtk4.

\begin{itemize}
\tightlist
\item
  Paquetes de la distribución.
\item
  Compilarlo desde la fuente.
\item
  Instalar una distribución con Gnome 40 y gnome-boxes.
\end{itemize}

\hypertarget{instalaciuxf3n-desde-los-paquetes-de-la-distribuciuxf3n}{%
\subsection{Instalación desde los paquetes de la
distribución}\label{instalaciuxf3n-desde-los-paquetes-de-la-distribuciuxf3n}}

La primera manera es la más fácil de instalar, y la recomendada.

Se ha probado usando Ubuntu 22.04 que es la versión mas reciente de
Ubuntu.

\begin{lstlisting}
$ sudo apt-get install libgtk-4-bin libgtk-4-common libgtk-4-dev libgtk-4-doc
\end{lstlisting}

También es posible en Fedora, Arch, Debian y OpenSUSE. Ver
\href{https://www.gtk.org/docs/installations/linux\#installing-gtk-from-packages}{Installing
GTK from packages}. La siguiente tabla muestra las distribuciones que
soportan Gtk4.

\begin{longtable}[]{@{}cccc@{}}
\toprule
Distribución & version & Gtk4 & Gnome40\tabularnewline
\midrule
\endhead
Fedora & 36 & 4.4.2 & Gnome42\tabularnewline
Ubuntu & 22.04lts & 4.4 & Gnome41(4.6.2)\tabularnewline
Debian & bookworm(testing) & 4.6.5 & Gnome42\tabularnewline
Arch & rolling release & 4.6.5 & Gnome42\tabularnewline
Gentoo & rolling release & 4.6.5 & Gnome42\tabularnewline
OpenSUSE & Tumbleweed(rolling release) & 4.6.5 & Gnome42\tabularnewline
\bottomrule
\end{longtable}

Si has instalado Gtk4 desde los paquetes, no necesitas leer el resto de
esta sección.

\hypertarget{instalaciuxf3n-desde-los-archivos-fuente}{%
\subsection{Instalación desde los archivos
fuente}\label{instalaciuxf3n-desde-los-archivos-fuente}}

Si tu sistema operativo no tiene los paquetes de Gtk4 o deseas tener la
versión mas reciente, necesitas compilarlo desde la fuente.

Se ha probado la instalación desde la fuente en Enero 2021. Por lo tanto
la siguiente información es antigua, specialmente la versión de cada
software. Para la información mas reciente, ve
\href{https://docs.gtk.org/gtk4/building.html}{Gtk API Reference,
Building GTK}.

\hypertarget{requisitos-para-instalar-gtk4-desde-la-fuente}{%
\subsubsection{Requisitos para instalar Gtk4 desde la
fuente}\label{requisitos-para-instalar-gtk4-desde-la-fuente}}

\begin{itemize}
\tightlist
\item
  Sistema operativo Linux, por ejemplo, Ubuntu 22.04 LTS
\item
  Paquetes de desarrollo como gcc, meson, ninja, git, wget, etc.
\item
  Los paquetes dev son necesarios para cada software a continuación.
\end{itemize}

\hypertarget{objetivo-de-la-instalaciuxf3n}{%
\subsubsection{Objetivo de la
instalación}\label{objetivo-de-la-instalaciuxf3n}}

Se ha instalado Gtk4 dentro del directorio
\passthrough{\lstinline!$HOME/local!}. esta es una área privada del
usuario.

Si deseas instalarlo en el área del sistema,
\passthrough{\lstinline!/opt/gtk4!} es un buen lugar.
\href{https://docs.gtk.org/gtk4/building.html}{Gtk API Reference,
Building GTK} te da una buena descripción para hacerlo en
\passthrough{\lstinline!/opt/gtk4!}.

Nunca lo instales en \passthrough{\lstinline!/usr/local!} que es el
predeterminado. Es usado por las aplicaciones de Ubuntu que no han sido
construidas con Gtk4. Entonces hay altas probabilidades de dañar algo.

\hypertarget{instalaciuxf3n-en-ubuntu-21.10}{%
\subsubsection{Instalación en Ubuntu
21.10+}\label{instalaciuxf3n-en-ubuntu-21.10}}

La mayoría de las bibliotecas están incluídas por Ubuntu 20.10+. Por lo
tanto puede ser instalado con \passthrough{\lstinline!apt-get!}. Y no es
necesario instalarla desde los archivos fuente. Puedes saltarte las
secciones siguientes (Glib, Pango, Gdk-pixbuf y Gtk-doc).

\hypertarget{glib-installation}{%
\subsubsection{Glib installation}\label{glib-installation}}

If your Ubuntu is 20.04LTS, you need to install prerequisite libraries
from the tarballs. Check the version of your library and if it is lower
than the necessary version, install it from the source.

For example,

\begin{lstlisting}
$ pkg-config --modversion glib-2.0
2.64.6
\end{lstlisting}

The necessary version is 2.66.0 or higher. Therefore, the example above
shows that you need to install Glib.

I installed 2.67.1 which was the latest version at that time (January
2021). Download Glib source files from the repository, then decompress
and extract files.

\begin{lstlisting}
$ wget https://download.gnome.org/sources/glib/2.67/glib-2.67.1.tar.xz
$ tar -Jxf glib-2.67.1.tar.xz
\end{lstlisting}

Some packages are required to build Glib. You can find them if you run
meson.

\begin{lstlisting}
$ meson --prefix $HOME/local _build
\end{lstlisting}

Use apt-get and install the prerequisites. For example,

\begin{lstlisting}
$ sudo apt-get install -y  libpcre2-dev libffi-dev
\end{lstlisting}

After that, compile Glib.

\begin{lstlisting}
$ rm -rf _build
$ meson --prefix $HOME/local _build
$ ninja -C _build
$ ninja -C _build install
\end{lstlisting}

Set several environment variables so that the Glib libraries installed
can be used by build tools. Make a text file below and save it as
\passthrough{\lstinline!env.sh!}

\begin{lstlisting}
# compiler
CPPFLAGS="-I$HOME/local/include"
LDFLAGS="-L$HOME/local/lib"
PKG_CONFIG_PATH="$HOME/local/lib/pkgconfig:$HOME/local/lib/x86_64-linux-gnu/pkgconfig"
export CPPFLAGS LDFLAGS PKG_CONFIG_PATH
# linker
LD_LIBRARY_PATH="$HOME/local/lib/x86_64-linux-gnu/"
PATH="$HOME/local/bin:$PATH"
export LD_LIBRARY_PATH PATH
# gsetting
export GSETTINGS_SCHEMA_DIR=$HOME/local/share/glib-2.0/schemas
\end{lstlisting}

Then, use . (dot) or source command to include these commands to the
current bash.

\begin{lstlisting}
$ . env.sh
\end{lstlisting}

or

\begin{lstlisting}
$ source env.sh
\end{lstlisting}

This command carries out the commands in
\passthrough{\lstinline!env.sh!} and changes the environment variables
above in the current shell.

\hypertarget{pango-installation}{%
\subsubsection{Pango installation}\label{pango-installation}}

Download and untar.

\begin{lstlisting}
$ wget https://download.gnome.org/sources/pango/1.48/pango-1.48.0.tar.xz
$ tar -Jxf pango-1.48.0.tar.xz
\end{lstlisting}

Try meson and check the required packages. Install all the
prerequisites. Then, compile and install Pango.

\begin{lstlisting}
$ meson --prefix $HOME/local _build
$ ninja -C _build
$ ninja -C _build install
\end{lstlisting}

It installs Pango-1.0.gir under
\passthrough{\lstinline!$HOME/local/share/gir-1.0!}. If you installed
Pango without \passthrough{\lstinline!--prefix!} option, then it would
be located at \passthrough{\lstinline!/usr/local/share/gir-1.0!}. This
directory (/usr/local/share) is used by applications. They find the
directory by the environment variable
\passthrough{\lstinline!XDG\_DATA\_DIRS!}. It is a text file which keep
the list of `share' directories like
\passthrough{\lstinline!/usr/share!},
\passthrough{\lstinline!usr/local/share!} and so on. Now
\passthrough{\lstinline!$HOME/local/share!} needs to be added to
\passthrough{\lstinline!XDG\_DATA\_DIRS!}, or error will occur in the
later compilation.

\begin{lstlisting}
$ export XDG_DATA_DIRS=$HOME/local/share:$XDG_DATA_DIRS
\end{lstlisting}

\hypertarget{gdk-pixbuf-and-gtk-doc-installation}{%
\subsubsection{Gdk-pixbuf and Gtk-doc
installation}\label{gdk-pixbuf-and-gtk-doc-installation}}

Download and untar.

\begin{lstlisting}
$ wget https://download.gnome.org/sources/gdk-pixbuf/2.42/gdk-pixbuf-2.42.2.tar.xz
$ tar -Jxf gdk-pixbuf-2.42.2.tar.xz
$ wget https://download.gnome.org/sources/gtk-doc/1.33/gtk-doc-1.33.1.tar.xz
$ tar -Jxf gtk-doc-1.33.1.tar.xz
\end{lstlisting}

Same as before, install prerequisite packages, then compile and install
them.

The installation of Gtk-doc put \passthrough{\lstinline!gtk-doc.pc!}
under \passthrough{\lstinline!$HOME/local/share/pkgconfig!}. This file
is used by pkg-config, which is one of the build tools. The directory
needs to be added to the environment variable
\passthrough{\lstinline!PKG\_CONFIG\_PATH!}

\begin{lstlisting}
$ export PKG_CONFIG_PATH="$HOME/local/share/pkgconfig:$PKG_CONFIG_PATH"
\end{lstlisting}

\hypertarget{gtk4-installation}{%
\subsubsection{Gtk4 installation}\label{gtk4-installation}}

If you want the latest development version of Gtk4, use git and clone
the repository.

\begin{lstlisting}
$ git clone https://gitlab.gnome.org/GNOME/gtk.git
\end{lstlisting}

If you want a stable version of Gtk4, then download it from
\href{https://download.gnome.org/sources/gtk/}{Gnome source website}.
The latest version is 4.3.1 (13/June/2021).

Compile and install it.

\begin{lstlisting}
$ meson --prefix $HOME/local _build
$ ninja -C _build
$ ninja -C _build install
\end{lstlisting}

If you want to know more information, refer to
\href{https://docs.gtk.org/gtk4/building.html}{Gtk4 API Reference,
Building GTK}.

\hypertarget{modify-env.sh}{%
\subsubsection{Modify env.sh}\label{modify-env.sh}}

Because environment variables disappear when you log out, you need to
add them again. Modify \passthrough{\lstinline!env.sh!}.

\begin{lstlisting}
# compiler
CPPFLAGS="-I$HOME/local/include"
LDFLAGS="-L$HOME/local/lib"
PKG_CONFIG_PATH="$HOME/local/lib/pkgconfig:$HOME/local/lib/x86_64-linux-gnu/pkgconfig:
$HOME/local/share/pkgconfig"
export CPPFLAGS LDFLAGS PKG_CONFIG_PATH
# linker
LD_LIBRARY_PATH="$HOME/local/lib/x86_64-linux-gnu/"
PATH="$HOME/local/bin:$PATH"
export LD_LIBRARY_PATH PATH
# gir
XDG_DATA_DIRS=$HOME/local/share:$XDG_DATA_DIRS
export XDG_DATA_DIRS
# gsetting
export GSETTINGS_SCHEMA_DIR=$HOME/local/share/glib-2.0/schemas
# girepository-1.0
export GI_TYPELIB_PATH=$HOME/local/lib/x86_64-linux-gnu/girepository-1.0
\end{lstlisting}

Include this file by . (dot) command before using Gtk4 libraries.

You may think you can add them in your
\passthrough{\lstinline!.profile!}. But it's a wrong decision. Never
write them to your \passthrough{\lstinline!.profile!}. The environment
variables above are necessary only when you compile and run Gtk4
applications. Otherwise it's not necessary. If you changed the
environment variables above and run Gtk3 applications, it probably
causes serious damage.

\hypertarget{compiling-gtk4-applications}{%
\subsubsection{Compiling Gtk4
applications}\label{compiling-gtk4-applications}}

Before you compile Gtk4 applications, define environment variables
above.

\begin{lstlisting}
$ . env.sh
\end{lstlisting}

After that you can compile them without anything. For example, to
compile \passthrough{\lstinline!sample.c!}, type the following.

\begin{lstlisting}
$ gcc `pkg-config --cflags gtk4` sample.c `pkg-config --libs gtk4`
\end{lstlisting}

To know how to compile Gtk4 applications, refer to the section 3
(GtkApplication and GtkApplicationWindow) and after.

\hypertarget{installing-fedora-34-with-gnome-boxes}{%
\subsection{Installing Fedora 34 with
gnome-boxes}\label{installing-fedora-34-with-gnome-boxes}}

The last part of this section is about Gnome40 and gnome-boxes. Gnome 40
is a new version of Gnome desktop system. And Gtk4 is installed in the
distribution. See \href{https://forty.gnome.org/}{Gnome 40 website}
first.

\emph{However, Gnome40 is not necessary to compile and run Gtk4
applications.}

There are seven choices at present.

\begin{itemize}
\tightlist
\item
  Gnome OS
\item
  Arch Linux
\item
  Gentoo Linux
\item
  Fedora 36
\item
  openSUSE Tumbleweed
\item
  Ubuntu 22.04
\item
  Debian bookworm
\end{itemize}

I've installed Fedora 34 with gnome-boxes. My OS was Ubuntu 21.04 at
that time. Gnome-boxes creates a virtual machine in Ubuntu and Fedora
will be installed to that virtual machine.

The instruction is as follows.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Download Fedora 34 iso file. There is an link at the end of
  \href{https://forty.gnome.org/}{Gnome 40 website}.
\item
  Install gnome-boxes with apt-get command.
\end{enumerate}

\begin{lstlisting}
$ sudo apt-get install gnome-boxes
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Run gnome-boxes.
\item
  Click on \passthrough{\lstinline!+!} button on the top left corner and
  launch a box creation wizard by clicking
  \passthrough{\lstinline!Create a Virtual Machine ...!}. Then a dialog
  appears. Click on
  \passthrough{\lstinline!Operationg System Image File!} and select the
  iso file you have downloaded.
\item
  Then, the Fedora's installer is executed. Follow the instructions by
  the installer. At the end of the installation, the installer instructs
  to reboot the system. Click on the right of the title bar and select
  reboot or shutdown.
\item
  Your display is back to the initial window of gnome-boxes, but there
  is a button \passthrough{\lstinline!Fedora 34 Workstation!} on the
  upper left of the window. Click on the button then Fedora will be
  executed.
\item
  A setup dialog appears. Setup Fedora according to the wizard.
\end{enumerate}

Now you can use Fedora. It includes Gtk4 libraries already. But you need
to install the Gtk4 development package. Use
\passthrough{\lstinline!dnf!} to install
\passthrough{\lstinline!gtk4.x86\_64!} package.

\begin{lstlisting}
$ sudo dnf install gtk4.x86_64
\end{lstlisting}

\hypertarget{gtk4-compilation-test}{%
\subsubsection{Gtk4 compilation test}\label{gtk4-compilation-test}}

You can test the Gtk4 development packages by compiling files which are
based on Gtk4. I've tried compiling \passthrough{\lstinline!tfe!} text
editor, which is written in section 21.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Run Firefox.
\item
  Open this website
  (\href{https://github.com/ToshioCP/Gtk4-tutorial}{Gtk4-Tutorial}).
\item
  Click on the green button labeled \passthrough{\lstinline!Code!}.
\item
  Select \passthrough{\lstinline!Download ZIP!} and download the codes
  from the repository.
\item
  Unzip the file.
\item
  Change your current directory to \passthrough{\lstinline!src/tfe7!}.
\item
  Compile it.
\end{enumerate}

\begin{lstlisting}
$ meson _build
bash: meson: command not found...
Install package 'meson' to provide command 'meson'? [N/y] y

 * Waiting in queue...
The following packages have to be installed:
 meson-0.56.2-2.fc34.noarch    High productivity build system
 ninja-build-1.10.2-2.fc34.x86_64    Small build system with a focus on speed
 vim-filesystem-2:8.2.2787-1.fc34.noarch    VIM filesystem layout
Proceed with changes? [N/y] y

... ...
... ...

The Meson build system
Version: 0.56.2

... ...
... ...

Project name: tfe
Project version: undefined
C compiler for the host machine: cc (gcc 11.0.0 "cc (GCC) 11.0.0 20210210 (Red Hat 11.0.0-0)")
C linker for the host machine: cc ld.bfd 2.35.1-38
Host machine cpu family: x86_64
Host machine cpu: x86_64
Found pkg-config: /usr/bin/pkg-config (1.7.3)
Run-time dependency gtk4 found: YES 4.2.0
Found pkg-config: /usr/bin/pkg-config (1.7.3)
Program glib-compile-resources found: YES (/usr/bin/glib-compile-resources)
Program glib-compile-schemas found: YES (/usr/bin/glib-compile-schemas)
Program glib-compile-schemas found: YES (/usr/bin/glib-compile-schemas)
Build targets in project: 4

Found ninja-1.10.2 at /usr/bin/ninja

$ ninja -C _build
ninja: Entering directory `_build'
[12/12] Linking target tfe

$ ninja -C _build install
ninja: Entering directory `_build'
[0/1] Installing files.
Installing tfe to /usr/local/bin
Installation failed due to insufficient permissions.
Attempting to use polkit to gain elevated privileges...
Installing tfe to /usr/local/bin
Installing /home/<username>/Gtk4-tutorial-main/src/tfe7/com.github.ToshioCP.tfe.gschema.xml to /usr/local/share/glib-2.0/schemas
Running custom install script '/usr/bin/glib-compile-schemas /usr/local/share/glib-2.0/schemas/'
\end{lstlisting}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Execute it.
\end{enumerate}

\begin{lstlisting}
$ tfe
\end{lstlisting}

Then, the window of \passthrough{\lstinline!tfe!} text editor appears.
The compilation and execution have succeeded.
